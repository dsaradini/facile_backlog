{% extends "project_base.html" %}
{% load staticfiles sekizai_tags humanize acl %}

{% block title %}{% trans "Dashboard" %}{% endblock %}

{% block content %}
<div class="row">
	<div class="col-md-8">
		<div class="row">
			<h1>{% trans "Organizations" %}
			<a class="btn btn-success btn-sm" href="{% url "org_create" %}">
				{% trans "Create organization" %}
			</a>
			</h1>
		{% if organizations %}
			<div class="col-md-12">
				{% for org in organizations %}
				<div style="clear:both;">
					<div>
						<h3 class="inline-title">
							{{ org.get_logo }}
							<a href="{% url 'org_detail' org.pk %}"> {{ org.name }}</a>
							{% if org|can_admin:request.user %}
								<small class="smaller">[
									<a class="text-muted" href="{% url 'org_edit' org.pk %}">{% trans "edit" %}</a>
									|
									<a class="text-muted" href="{% url 'org_delete' org.pk %}">{% trans "delete" %}</a>
									|
									<a class="text-muted" href="{% url "project_create" %}?org={{ org.pk }}">{% trans "new organization project" %}</a>
								]</small>
							{% endif %}
						</h3>
					</div>

					<div class="margin-left">
						<div class="row">
						{% for project in org.ordered_projects %}
								<div class="col-md-4"><i class="icon-book"></i> <a href="{% url "project_detail" project.pk %}">{{ project.name }}</a></div>
							{% if forloop.counter|divisibleby:3 %}
								</div><div class="row">
							{% endif %}
						{% empty %}
							<div class="text-warning">
								{% trans "You have no active project in this organization" %}
							</div>
						{% endfor %}
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
		{%  else %}
			<div class="text-warning margin-left">
				{% trans "You have no active organization" %}
			</div>
		{% endif %}
		</div>

		<div class="row">
		<h1>{% trans "Projects" %}
		<a class="btn btn-success btn-sm" href="{% url "project_create" %}">
			{% trans "New project" %}
		</a>
		</h1>
		{% if projects or guest_projects%}
			<div class="col-md-12">
				{% for object in projects %}
				<div>
					<h3 class="inline-title">
						<i class="icon-book"></i>
						<a href="{% url 'project_detail' object.pk %}"> {{ object.name }}</a>
						{% if object|can_admin:request.user %}
							<small class="smaller">[
								<a class="text-muted" href="{% url 'project_edit' object.pk %}">{% trans "edit" %}</a>
								|
								<a class="text-muted" href="{% url 'project_delete' object.pk %}">{% trans "delete" %}</a>
							]</small>
						{% endif %}
					</h3>
				</div>
				<div class="margin-left">
					<div class="col-md-12 text-muted small"><i class="icon-time"></i> {% trans "Last update" %}  {{ object.last_modified|naturaltime }}</div>
				</div>
				{% endfor %}
				{% for object in guest_projects %}
				<div>
					<h3 class="inline-title">
						<i class="icon-book"></i>
						<a href="{% url 'project_detail' object.pk %}"> {{ object.name }}</a>
						<span class="label">{% trans "Guest" %}</span>
						<span class="text-muted">{{  object.org.get_logo }} {{ object.org.name }}</span>
					</h3>
				</div>
				{% endfor %}
			</div>
		{%  else %}
			<div class="text-warning margin-left">
				{% trans "You have no active stand-alone project" %}
			</div>
		{% endif %}
		</div>
	</div>
	<div class="col-md-4">
		<h2>{% trans "Recent activities" %}</h2>
		<div class="actions"></div>
		{% include "backlog/_events.html" with events=events gravatar=True%}
	</div>
<div>
{% endblock %}
{% extends "base.html" %}
{% load staticfiles sekizai_tags markup acl %}

{% block title %}{% trans "Project" %} &mdash; {{ project.name }}{% endblock %}
{% block content %}
	<div class="path">
		<a href="{%  url "home" %}"><i class="icon-home"></i>{% trans "Home" %}</a> /
		<i class="icon-book"></i> <span class="current">{{ project.name }}</span>
	</div>
	<div id="links">
		<span class="tab active">{% trans "Backlogs" %}</span>
		<span class="tab">
			<a href="{% url "project_users" project.pk %}">{% trans "Members" %} </a>
		</span>
		<span class="tab">
			<a href="{% url "project_stories" project.pk %}">{% trans "Stories" %}</a>
		</span>
	</div>
	{% include "backlog/_project_head.html" %}
	<div class="description">
		{% if project.description %}
			{{ project.description|markdown }}
		{% endif %}
	</div>
	<h2>{% trans "Backlogs" %}</h2>
	<div class="actions">
		{% if project|can_admin:request.user %}
			<a class="button" href="{% url "backlog_create" project.pk %}">
				{% trans "Create backlog" %}
			</a>
		{% endif %}
	</div>
	<div class="backlog-list">
		<ul>
			{% for backlog in project.backlogs.all %}
				<li>
					<div class="title">
						<a href="{% url 'backlog_detail' project.pk backlog.pk %}"><i class="icon-list-ul black"></i> {{ backlog.name }}</a>
					</div>
					<div class="stats">
						<div class="story-stats percent-cell">
							<div class="name">
								<i class="icon-list-alt info"></i> <b>{{ backlog.stats.total_stories }}</b>
								&nbsp;</span><a href="{% url "backlog_detail" project.pk backlog.pk %}" class="info">{% trans "Stories" %} </a>
								&nbsp;
								<i class="icon-circle info"></i> <b>{{ backlog.stats.total_points }}</b>
								&nbsp;</span><a href="{% url "backlog_detail" project.pk backlog.pk %}" class="info">{% trans "Points" %} </a>
							</div>
							{% if backlog.stats.estimated_stories %}
								<span class="percent bg-blue" style="width:{{ backlog.stats.percent_estimated }}%">{{ backlog.stats.estimated_stories }} <i class="icon-circle info"></i> {{ backlog.stats.estimated_points }} pts</span>
							{% else %}
								<span class="percent" style="width:0"></span>
							{% endif %}
							{% if backlog.stats.completed_stories %}
								<span class="percent bg-green" style="width:{{ backlog.stats.percent_completed }}%">{{ backlog.stats.completed_stories }} <i class="icon-circle info"></i> {{ backlog.stats.completed_points }} pts</span>
							{% else %}
								<span class="percent" style="width:0"></span>
							{% endif %}
						</div>
					</div>
					<div class="top-stories">
						{% for story in backlog.top_stories %}
							<div class="story">
								<a class="code" href="{% url "story_backlog_detail" project.pk backlog.pk story.pk %}"><i class="icon-list-alt" title="{{ story.text }}"></i> {{ story.code }}</a>

							</div>
						{% empty %}
							{% trans "No story in this backlog" %}<br>
							<a class="alt-button" href="{% url "story_create" project.pk backlog.pk %}">{% trans "Create a story" %}</a>
						{% endfor %}
					</div>
				</li>
			{% empty %}
				{% trans "No backlog" %}
			{% endfor %}
		</ul>
	</div>

{% endblock %}
{% extends "base.html" %}

{% load static sekizai_tags jsonify %}

{% block title %}{% if object %}{% trans "Edit story" %}{% else %}{% trans "Add a new story" %}{% endif %}{% endblock %}

{% block content %}
	{% if not object %}<h1>{% trans "Add a new story" %}</h1>{% endif %}
    <form method="post" id="edit_story_form" action="{% if object %}{% url "story_backlog_edit" project.pk backlog.pk object.pk %}{% else %}{% url "story_create" project.pk backlog.pk %}{% endif %}">

        {% csrf_token %}
		{% if direct %}
			<input type="hidden" name="direct" value="true">
		{% endif %}
        {% include "form.html" %}
        <div class="submit actions">
			<input class="button" type="submit" value="{% if object %}{% trans "Save changes" %}{% else %}{% trans "Create story" %}{% endif %}">
			<a class="alt-button" href="{{ cancel_url }}">{% trans "Cancel" %}</a>
		</div>
	</form>
{% addtoblock "js" %}
<script type="text/javascript" src="{% static "core/js/jquery.js" %}"></script>
{% endaddtoblock %}

{% addtoblock "js" %}
<script type="text/javascript" src="{% static "core/js/jquery.csrf.js" %}"></script>
{% endaddtoblock %}

{% addtoblock "js" %}
<script type="text/javascript" src="{% static "core/js/jquery.colorpicker.js" %}"></script>
{% endaddtoblock %}

{% addtoblock "js" %}
<script type="text/javascript" src="{% static "core/js/jquery.select2.js" %}"></script>
{% endaddtoblock %}

{% addtoblock "js" %}
<script type="text/javascript">
$(function(){
	$('[name="color"]').simpleColorPicker({
		picker: true
	});
	$('[name="theme"]').select2({
		width: "500px",
		maximumInputLength: 255,
		maximumSelectionSize: 1,
		tags: {{ backlog.all_themes|jsonify }}
	});
	$('[name="status"]').select2({
		width: "200px"
	});
	$('[name="points"]').select2({
		width: "100px"
	});
	/*
	$('[name="points"]').select2({
		width: "100px",
		maximumInputLength: 3,
		maximumSelectionSize: 1,
		allowClear: false,
		multiple: false,
		tags: ['-1', '0', '1', '2', '3', '5', '8', '13', '20', '40', '100'],
		formatSelection:function(object, container) {
			if (object.text == '-1') return "not set";
			return object.text;
		},
		formatResult:function(object, container, query) {
			if (object.text == '-1') return "not set";
			return object.text;
		}
	});
	*/
})
</script>
{% endaddtoblock %}

{% endblock %}
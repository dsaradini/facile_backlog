{% extends "project_base.html" %}

{% load static sekizai_tags jsonify %}

{% block title %}{% if object %}{% trans "Edit story" %}{% else %}{% trans "Add a new story" %}{% endif %}{% endblock %}

{% block content %}
<div class="row-fluid">
	<div class="span6 offset3 base-form">
	{% if not object %}<h1>{% trans "Add a new story" %}</h1>{% endif %}
	{% if object %}
		{% url "story_edit" project.pk object.pk as target_url%}
	{% else %}
		{% url "story_create" project.pk backlog.pk as target_url%}
	{% endif %}
    <form method="post" id="edit_story_form" action="{{ target_url }}">

        {% csrf_token %}
		{% if direct %}
			<input type="hidden" name="direct" value="true">
		{% endif %}
        {% include "form.html" %}
        <div class="submit">
			<input class="btn btn-success" type="submit" value="{% if object %}{% trans "Save changes" %}{% else %}{% trans "Create story" %}{% endif %}">
			<a class="btn btn-link" href="{{ cancel_url }}">{% trans "Cancel" %}</a>
		</div>
	</form>
	</div>
</div>
{% addtoblock "js" %}
<script type="text/javascript">
$(function(){
	$('[name="as_a"]').attr("autocomplete", "off");
	$('[name="as_a"]').typeahead({
		source: {{ project.all_as_a|jsonify }}
	});
	$('[name="theme"]').attr("autocomplete", "off");
	$('[name="theme"]').typeahead({
		source: {{ backlog.all_themes|jsonify }}
	});
	$('[name="color"]').simpleColorPicker({
		picker: true
	});
	$('[name="status"]').select2({
		width: "200px"
	});
	$('[name="points"]').select2({
		width: "100px"
	});
})
</script>
{% endaddtoblock %}

{% endblock %}